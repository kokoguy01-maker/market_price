<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>시장 현황 요약</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Noto Sans KR", sans-serif;
  background: #ffffff;
}
.wrap {
  max-width: 900px;
  margin: 0 auto;
  padding: 16px;
}
h1 {
  font-size: 20px;
  margin-bottom: 6px;
}
.muted {
  font-size: 12px;
  color: #666;
  margin-bottom: 14px;
}
.summary {
  display: flex;
  flex-direction: column;
  gap: 16px;
}
.box {
  border: 1px solid #e5e5e5;
  border-radius: 12px;
  padding: 14px;
}
.k {
  font-size: 13px;
  color: #666;
  margin-bottom: 6px;
}
.v {
  font-size: 22px;
  font-weight: 700;
}
.ts {
  font-size: 11px;
  margin-top: 6px;
  color: #888;
}
iframe {
  width: 100%;
  height: 360px;
  border: none;
}
</style>
</head>

<body>
<div class="wrap">
  <h1>시장 현황 요약</h1>
  <div class="muted">
    미국채 10Y: 기준 시각 | 환율·유가: 실시간 (TradingView)
  </div>

  <div class="summary">

    <!-- USD/KRW 환율 (TradingView 실시간) -->
    <div class="box">
      <div class="k">USD/KRW 환율 ● REAL-TIME</div>
      <iframe
        src="https://s.tradingview.com/widgetembed/?symbol=FX_IDC%3AUSDKRW&interval=1&theme=light&style=1&locale=kr">
      </iframe>
    </div>

    <!-- 미국채 10Y (기존 유지) -->
    <div class="box">
      <div class="k">미국채 10년물 수익률 (10Y)</div>
      <div class="v" id="v_10y">-</div>
      <div class="ts" id="t_10y"></div>
      <canvas id="chart10y" height="240"></canvas>
    </div>

    <!-- WTI 유가 (TradingView 실시간) -->
    <div class="box">
      <div class="k">WTI 유가 ● REAL-TIME</div>
      <iframe
        src="https://s.tradingview.com/widgetembed/?symbol=NYMEX%3ACL1!&interval=1&theme=light&style=1&locale=kr">
      </iframe>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
async function loadJSON(url) {
  const res = await fetch(url + '?t=' + Date.now());
  if (!res.ok) throw new Error('Fetch failed');
  return res.json();
}

(async () => {
  try {
    // 미국채 10Y JSON (기존 유지)
    const us10y = await loadJSON('./data/us10y.json');
    const meta = us10y.chart.result[0].meta;
    const ts = us10y.chart.result[0].timestamp;
    const values = us10y.chart.result[0].indicators.quote[0].close;

    document.getElementById('v_10y').innerText =
      meta.regularMarketPrice.toFixed(2) + ' %';
    document.getElementById('t_10y').innerText =
      '기준 시각: ' + new Date(meta.regularMarketTime * 1000).toLocaleString();

    // 차트 유지
    const labels = ts.map(t => new Date(t * 1000).toLocaleTimeString());
    new Chart(document.getElementById('chart10y'), {
      type: 'line',
      data: {
        labels,
        datasets: [{
          data: values,
          borderColor: '#333',
          borderWidth: 1,
          pointRadius: 0
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false }},
        scales: { x: { display: false } }
      }
    });

  } catch (e) {
    console.error(e);
  }
})();
</script>

</body>
</html>
