<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>시장 현황 요약</title>

<!-- TradingView -->
<script src="https://s3.tradingview.com/tv.js"></script>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Noto Sans KR", sans-serif;
  background: linear-gradient(180deg, #0b1220, #060a14);
  color: #fff;
}

.wrap {
  max-width: 980px;
  margin: 0 auto;
  padding: 20px;
}

h1 {
  font-size: 22px;
  margin-bottom: 6px;
}

.muted {
  font-size: 12px;
  color: #9aa4b2;
  margin-bottom: 20px;
}

/* ===== 카드 ===== */
.card {
  background: linear-gradient(180deg, #1a2233, #141b29);
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 16px;
}

/* ===== TradingView 요약 ===== */
.tv-summary {
  height: 120px;
}

/* ===== 차트 ===== */
.tv-chart {
  width: 100%;
  min-height: 360px;
}

/* ===== 미국채 ===== */
.bond-value {
  font-size: 28px;
  font-weight: 700;
}

.bond-ts {
  font-size: 12px;
  color: #9aa4b2;
  margin-top: 6px;
}
</style>
</head>

<body>
<div class="wrap">

<h1>시장 현황 요약</h1>
<div class="muted">
환율·유가: 실시간(TradingView) / 미국채 10Y: 30분 기준(Yahoo Finance)
</div>

<!-- ===== 요약 카드 ===== -->

<div class="card">
  <div id="usdkrw-summary" class="tv-summary"></div>
</div>

<div class="card">
  <div id="wti-summary" class="tv-summary"></div>
</div>

<div class="card">
  <div>미국채 10년물 수익률</div>
  <div class="bond-value" id="bond10y">-</div>
  <div class="bond-ts" id="bond-ts"></div>
</div>

<!-- ===== 차트 ===== -->

<div class="card">
  <div>USD/KRW 환율 차트 (REAL-TIME)</div>
  <div id="usdkrw-chart" class="tv-chart"></div>
</div>

<div class="card">
  <div>WTI 유가 차트 (REAL-TIME)</div>
  <div id="wti-chart" class="tv-chart"></div>
</div>

<div class="card">
  <div>미국채 10년물 (30분 기준)</div>
  <canvas id="bondChart" height="360"></canvas>
</div>

</div>

<!-- ===== 스크립트 ===== -->

<script>
window.onload = function () {

  /* ========= TradingView 요약 ========= */

  new TradingView.MiniSymbolWidget({
    symbol: "FX_IDC:USDKRW",
    width: "100%",
    height: 120,
    locale: "kr",
    dateRange: "1D",
    colorTheme: "dark",
    isTransparent: true,
    noTimeScale: true
  }, "usdkrw-summary");

  new TradingView.MiniSymbolWidget({
    symbol: "TVC:USOIL",
    width: "100%",
    height: 120,
    locale: "kr",
    dateRange: "1D",
    colorTheme: "dark",
    isTransparent: true,
    noTimeScale: true
  }, "wti-summary");

  /* ========= TradingView 차트 ========= */

  new TradingView.widget({
    symbol: "FX_IDC:USDKRW",
    interval: "5",
    timezone: "Asia/Seoul",
    theme: "dark",
    style: "3",
    locale: "kr",
    autosize: true,
    container_id: "usdkrw-chart"
  });

  new TradingView.widget({
    symbol: "TVC:USOIL",
    interval: "5",
    timezone: "Asia/Seoul",
    theme: "dark",
    style: "3",
    locale: "kr",
    autosize: true,
    container_id: "wti-chart"
  });

  /* ========= 미국채 10Y (Yahoo Finance JSON) ========= */

  fetch("./data/us10y.json?t=" + Date.now())
    .then(r => r.json())
    .then(j => {
      const meta = j.chart.result[0].meta;
      const ts = j.chart.result[0].timestamp;
      const price = j.chart.result[0].indicators.quote[0].close;

      document.getElementById("bond10y").innerText =
        meta.regularMarketPrice.toFixed(2) + " %";

      document.getElementById("bond-ts").innerText =
        "기준시각: " + new Date(meta.regularMarketTime * 1000).toLocaleString();

      const ctx = document.getElementById("bondChart").getContext("2d");
      new Chart(ctx, {
        type: "line",
        data: {
          labels: ts.map(t => new Date(t * 1000).toLocaleTimeString()),
          datasets: [{
            data: price,
            borderColor: "#8aa4ff",
            borderWidth: 2,
            pointRadius: 0
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { x: { display: false } }
        }
      });
    });

};
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>
